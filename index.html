<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Key Value Entry</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: sans-serif;
      background: #fff;
      padding: 24px;
      max-width: 420px;
      margin: auto;
    }

    h2 {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }

    input {
      width: 100%;
      padding: 8px;
      font-size: 14px;
      margin-top: 4px;
      box-sizing: border-box;
    }

    button {
      margin-top: 16px;
      padding: 10px 14px;
      font-size: 14px;
      cursor: pointer;
    }

    canvas {
      display: block;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>Data Entry</h2>

<label>
  Bundle Number:
  <input id="bundle" />
</label>

<label>
  Heat No:
  <input id="heat" />
</label>

<label>
  Net Weight:
  <input id="weight" />
</label>

<button id="export">Export URL as PNG</button>

<canvas id="qr"></canvas>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
<script>
  const fields = {
    bundle: document.getElementById('bundle'),
    heat: document.getElementById('heat'),
    weight: document.getElementById('weight')
  };

  function encode(obj) {
    return btoa(JSON.stringify(obj))
      .replace(/\+/g, '-')
      .replace(/\//g, '_')
      .replace(/=+$/, '');
  }

  function decode(str) {
    str = str.replace(/-/g, '+').replace(/_/g, '/');
    return JSON.parse(atob(str));
  }

  function saveToURL() {
    const data = {
      bundle: fields.bundle.value,
      heat: fields.heat.value,
      weight: fields.weight.value
    };
    location.hash = 'data=' + encode(data);
  }

  function loadFromURL() {
    const params = new URLSearchParams(location.hash.slice(1));
    const d = params.get('data');
    if (!d) return;
    const data = decode(d);
    fields.bundle.value = data.bundle || '';
    fields.heat.value = data.heat || '';
    fields.weight.value = data.weight || '';
  }

  Object.values(fields).forEach(input => {
    input.addEventListener('input', saveToURL);
  });

  document.getElementById('export').onclick = () => {
    const url = location.href;
    QRCode.toCanvas(
      document.getElementById('qr'),
      url,
      { width: 280 },
      err => { if (err) console.error(err); }
    );
  };

  loadFromURL();
</script>

</body>
</html>
